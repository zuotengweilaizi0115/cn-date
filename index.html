<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>日付・曜日を中国語で練習</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    button, select { padding: 1em; margin: 1em; font-size: 1em; }
    #japanese, #chinese, #pinyin { font-size: 1.5em; margin: 1em 0; }
  </style>
</head>
<body>
  <h1>日付・曜日を中国語で練習</h1>
  <div id="japanese">ここに日本語の日付が表示されます</div>
  <div id="chinese"></div>
  <div id="pinyin"></div>
  <button onclick="generateRandomDate()">日付を生成する</button>
  <button onclick="showChineseText()">中国語で表示</button>
  <button onclick="showChinesePinyin()">声調記号付きピンインで表示</button>
  <div style="display: inline-flex; align-items: center; gap: 1em;">
    <select id="voiceSelect"></select>
    <button onclick="playChineseAudio()">中国語音声を再生</button>
  </div>

  <script>
    const weekdays = ["日曜日", "月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日"];
    const weekdaysChinese = [
      {hanzi: "星期天", pinyin: "xīngqītiān"},
      {hanzi: "星期一", pinyin: "xīngqīyī"},
      {hanzi: "星期二", pinyin: "xīngqī’èr"},
      {hanzi: "星期三", pinyin: "xīngqīsān"},
      {hanzi: "星期四", pinyin: "xīngqīsì"},
      {hanzi: "星期五", pinyin: "xīngqīwǔ"},
      {hanzi: "星期六", pinyin: "xīngqīliù"}
    ];

    const numberPinyinMap = {
      1: "yī", 2: "èr", 3: "sān", 4: "sì", 5: "wǔ", 6: "liù", 7: "qī",
      8: "bā", 9: "jiǔ", 10: "shí", 11: "shíyī", 12: "shí’èr", 13: "shísān",
      14: "shísì", 15: "shíwǔ", 16: "shíliù", 17: "shíqī", 18: "shíbā", 19: "shíjiǔ",
      20: "èrshí",
      21: "èrshiyī", 22: "èrshi’èr", 23: "èrshisān", 24: "èrshisì",
      25: "èrshiwǔ", 26: "èrshiliù", 27: "èrshiqī", 28: "èrshibā", 29: "èrshijiǔ",
      30: "sānshí", 31: "sānshiyī"
    };

    let currentDate = null;
    let voices = [];

    function populateVoiceList() {
      voices = speechSynthesis.getVoices()
        .filter(voice => ["Google 普通话（中国大陆）", "Ting-Ting", "Li-Mu"].includes(voice.name));

      const select = document.getElementById('voiceSelect');
      select.innerHTML = '';

      voices.forEach((voice, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.text = `${voice.name} (${voice.lang})`;
        select.appendChild(option);
      });
    }

    if (typeof speechSynthesis !== 'undefined') {
      populateVoiceList();
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
      }
    }

    function generateRandomDate() {
      const month = Math.floor(Math.random() * 12) + 1;
      const day = Math.floor(Math.random() * 31) + 1;
      const weekdayIndex = Math.floor(Math.random() * 7);

      currentDate = {
        month,
        day,
        weekdayIndex
      };

      document.getElementById("japanese").innerText = `${month}月${day}日（${weekdays[weekdayIndex]}）`;
      document.getElementById("chinese").innerText = "";
      document.getElementById("pinyin").innerText = "";
    }

    function showChineseText() {
      if (!currentDate) return;
      const { month, day, weekdayIndex } = currentDate;
      const monthHanzi = `${month}月`;
      const dayHanzi = `${day}号`;
      const weekday = weekdaysChinese[weekdayIndex];
      const chineseText = `${monthHanzi}${dayHanzi}（${weekday.hanzi}）`;
      document.getElementById("chinese").innerText = chineseText;
    }

    function showChinesePinyin() {
      if (!currentDate) return;
      const { month, day, weekdayIndex } = currentDate;
      const weekday = weekdaysChinese[weekdayIndex];
      const monthPinyin = numberPinyinMap[month] + " yuè";
      const dayPinyin = numberPinyinMap[day] + " hào";
      const pinyinText = `${monthPinyin} ${dayPinyin} (${weekday.pinyin})`;
      document.getElementById("pinyin").innerText = pinyinText;
    }

    function playChineseAudio() {
      if (!currentDate) return;
      const { month, day, weekdayIndex } = currentDate;
      const monthHanzi = `${month}月`;
      const dayHanzi = `${day}号`;
      const weekday = weekdaysChinese[weekdayIndex].hanzi;
      const utterance = new SpeechSynthesisUtterance(`${monthHanzi}${dayHanzi} ${weekday}`);
      utterance.lang = 'zh-CN';
      utterance.rate = 0.5;

      const selectedVoice = voices[document.getElementById('voiceSelect').value];
      if (selectedVoice) {
        utterance.voice = selectedVoice;
      }

      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
